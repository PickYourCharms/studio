<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Build My Bracelet</title>

<style>
  body {
    margin: 0;
    padding: 16px;
    font-family: system-ui, -apple-system, sans-serif;
    background: #fff;
    text-align: center;
  }

  /* ================= HEADER ================= */
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    margin-bottom: 8px;
  }

  .topbar span {
    cursor: pointer;
    color: #555;
  }

  h2 {
    margin: 10px 0 14px;
    font-size: 20px;
  }

  /* ================= METAL TOGGLE ================= */
  .metal-toggle {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 14px;
  }

  .metal-toggle button {
    border-radius: 999px;
    padding: 6px 14px;
    border: 1px solid #ddd;
    background: #fff;
    cursor: pointer;
    font-size: 14px;
  }

  .metal-toggle .active {
    background: #000;
    color: #fff;
    border-color: #000;
  }

  /* ================= CANVAS ================= */
  .canvas {
    position: relative;
    width: min(92vw, 360px);
    aspect-ratio: 1 / 1;
    margin: 0 auto;
  }

  .bracelet {
    position: absolute;
    width: 72%;
    height: 72%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
  }

  /* ================= CHARMS ================= */
  .charm {
    position: absolute;
    cursor: pointer;
    user-select: none;
    transform-origin: top center;
  }

  .charm img {
    display: block;
    width: 46px;
    height: auto;
    pointer-events: none;
  }

  .hint {
    margin: 10px 0 14px;
    font-size: 14px;
    color: #666;
  }

  /* ================= TRAY ================= */
  .tray {
    display: flex;
    justify-content: center;
    gap: 14px;
    margin-bottom: 18px;
  }

  .tray img {
    width: 44px;
    height: auto;
    cursor: pointer;
  }

  /* ================= PRICE ================= */
  .price {
    font-size: 15px;
    margin-bottom: 70px;
    color: #111;
  }

  /* ================= CTA ================= */
  .cta {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 16px;
    display: none;
    justify-content: center;
  }

  .cta button {
    width: min(92vw, 360px);
    padding: 14px;
    border-radius: 999px;
    border: none;
    background: #000;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
  }
</style>
</head>

<body>

<!-- ================= TOP BAR ================= -->
<div class="topbar">
  <span onclick="history.back()">‚Üê Back</span>
  <span onclick="resetBuilder()">Reset</span>
</div>

<h2>Build My Bracelet</h2>

<!-- ================= METAL TOGGLE ================= -->
<div class="metal-toggle">
  <button id="goldBtn" class="active" onclick="switchMetal('gold')">Gold</button>
  <button id="silverBtn" onclick="switchMetal('silver')">Silver</button>
</div>

<!-- ================= CANVAS ================= -->
<div class="canvas" id="canvas">
  <img id="braceletBase"
       src="assets/bases/bracelet_base_gold.png"
       class="bracelet"
       alt="Bracelet base" />
</div>

<div class="hint">Tap a charm to add ‚Ä¢ Tap charm to remove</div>

<!-- ================= TRAY ================= -->
<div class="tray" id="tray"></div>

<div class="price" id="priceText">
  Start by choosing a charm
</div>

<!-- ================= CTA ================= -->
<div class="cta">
  <button id="ctaBtn">Love it ¬∑ Add to Bag üõçÔ∏è</button>
</div>

<script>
/* ================= LOCKED PHYSICS ================= */
const CHARM_PHYSICS = {
  size: 46,
  anchorX: 23,
  anchorY: 6,
  scale: 0.9,
  attachOffset: 2
};

/* ================= SLOT ANGLES ================= */
const SLOT_ANGLES = {
  1: [90],
  2: [70, 110],
  3: [60, 90, 120],
  4: [45, 75, 105, 135],
  5: [40, 65, 90, 115, 140]
};

const CHARMS = [
  '3DBowRibbon_Charm',
  'EvilEye_Charm',
  'LetterA_Charm',
  'NorthStar_Charm',
  'RedCherry_Charm'
];

let metal = 'gold';
let charms = [];

const canvas = document.getElementById('canvas');
const tray = document.getElementById('tray');
const priceText = document.getElementById('priceText');
const cta = document.querySelector('.cta');
const braceletBase = document.getElementById('braceletBase');

/* ================= INIT ================= */
renderTray();

/* ================= METAL SWITCH ================= */
function switchMetal(nextMetal) {
  if (nextMetal === metal) return;

  if (charms.length > 0) {
    if (!confirm('Switching metal will reset your bracelet. Continue?')) return;
    charms = [];
    render();
  }

  metal = nextMetal;
  braceletBase.src = `assets/bases/bracelet_base_${metal}.png`;

  document.getElementById('goldBtn').classList.toggle('active', metal === 'gold');
  document.getElementById('silverBtn').classList.toggle('active', metal === 'silver');

  renderTray();
}

/* ================= TRAY ================= */
function renderTray() {
  tray.innerHTML = '';
  CHARMS.forEach(name => {
    const img = document.createElement('img');
    img.src = `assets/charms/${name}_${metal}.png`;
    img.onclick = () => addCharm(img.src);
    tray.appendChild(img);
  });
}

/* ================= ADD / REMOVE ================= */
function addCharm(src) {
  if (charms.length >= 5) return;
  charms.push(src);
  render();
}

function removeCharm(index) {
  charms.splice(index, 1);
  render();
}

/* ================= RESET ================= */
function resetBuilder() {
  if (charms.length === 0) return;
  if (!confirm('Clear your bracelet design?')) return;
  charms = [];
  render();
}

/* ================= RENDER ================= */
function render() {
  document.querySelectorAll('.charm').forEach(el => el.remove());

  if (charms.length === 0) {
    priceText.textContent = 'Start by choosing a charm';
    cta.style.display = 'none';
    return;
  }

  const rect = canvas.getBoundingClientRect();
  const cx = rect.width / 2;
  const cy = rect.height / 2;
  const radius = rect.width * 0.36;
  const angles = SLOT_ANGLES[charms.length];

  charms.forEach((src, i) => {
    const angleDeg = angles[angles.length - 1 - i];
    const rad = angleDeg * Math.PI / 180;

    const x = cx + radius * Math.cos(rad);
    const y = cy + radius * Math.sin(rad) + CHARM_PHYSICS.attachOffset;

    const wrapper = document.createElement('div');
    wrapper.className = 'charm';
    wrapper.style.left = `${x - CHARM_PHYSICS.anchorX}px`;
    wrapper.style.top = `${y - CHARM_PHYSICS.anchorY}px`;
    wrapper.style.transform = `
      rotate(${angleDeg - 90}deg)
      scale(${CHARM_PHYSICS.scale})
    `;

    const img = document.createElement('img');
    img.src = src;
    wrapper.appendChild(img);
    wrapper.onclick = () => removeCharm(i);

    canvas.appendChild(wrapper);
  });

  const total = 249 + Math.max(0, charms.length - 1) * 80;
  priceText.textContent = `Your bracelet ¬∑ Rs. ${total}`;
  cta.style.display = 'flex';
}
</script>

</body>
</html>
