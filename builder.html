<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Build My Bracelet</title>

<style>
  body {
    margin: 0;
    padding: 16px;
    font-family: system-ui, -apple-system, sans-serif;
    background: #fff;
    text-align: center;
  }

  h2 {
    margin-bottom: 10px;
  }

  /* =========================
     CANVAS (RESPONSIVE)
     ========================= */
  .canvas {
    position: relative;
    width: min(92vw, 360px);
    aspect-ratio: 1 / 1;
    margin: 0 auto;
  }

  /* =========================
     BRACELET BASE
     ========================= */
  .bracelet {
    position: absolute;
    width: 78%;
    height: 78%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
  }

  /* =========================
     CHARMS
     ========================= */
  .charm {
    position: absolute;
    cursor: pointer;
    user-select: none;
    transform-origin: top center;
  }

  .charm img {
    display: block;
    width: 42px;
    height: auto;
    pointer-events: none;
  }

  .hint {
    margin-top: 8px;
    font-size: 14px;
    color: #666;
  }

  /* =========================
     TRAY
     ========================= */
  .tray {
    display: flex;
    justify-content: center;
    gap: 14px;
    margin-top: 18px;
  }

  .tray img {
    width: 44px;
    height: auto;
    cursor: pointer;
  }
</style>
</head>

<body>

<h2>Build My Bracelet</h2>

<div class="canvas" id="canvas">
  <img
    src="assets/bases/bracelet_base_gold.png"
    class="bracelet"
    alt="Bracelet base"
  />
</div>

<div class="hint">Tap a charm to add â€¢ Tap charm to remove</div>

<div class="tray">
  <img src="assets/charms/3DBowRibbon_Charm_Gold.png" onclick="addCharm(this.src)" />
  <img src="assets/charms/EvilEye_Charm_Gold.png" onclick="addCharm(this.src)" />
  <img src="assets/charms/LetterA_Charm_Gold.png" onclick="addCharm(this.src)" />
  <img src="assets/charms/NorthStar_Charm_Gold.png" onclick="addCharm(this.src)" />
  <img src="assets/charms/RedCherry_Charm_Gold.png" onclick="addCharm(this.src)" />
</div>

<script>
/* =========================
   GLOBAL CHARM PHYSICS
   (YOUR ONLY TUNING PANEL)
   ========================= */
const CHARM_PHYSICS = {
  size: 42,
  anchorX: 21,
  anchorY: 6,
  scale: 0.9,
  attachOffset: 10
};

/* =========================
   GEOMETRY (LOCKED)
   ========================= */
const SLOT_ANGLES = {
  1: [90],
  2: [70, 110],
  3: [60, 90, 120],
  4: [30, 70, 110, 150],
  5: [40, 65, 90, 115, 140]
};

const canvas = document.getElementById('canvas');
let charms = [];

function addCharm(src) {
  if (charms.length >= 5) return;
  charms.push(src);
  render();
}

function removeCharm(index) {
  charms.splice(index, 1);
  render();
}

function render() {
  document.querySelectorAll('.charm').forEach(el => el.remove());
  if (charms.length === 0) return;

  const rect = canvas.getBoundingClientRect();
  const cx = rect.width / 2;
  const cy = rect.height / 2;

  const radius = rect.width * 0.36;
  const angles = SLOT_ANGLES[charms.length];

  charms.forEach((src, i) => {
    const angleDeg = angles[angles.length - 1 - i];
    const rad = angleDeg * Math.PI / 180;

    const chainX = cx + radius * Math.cos(rad);
    const chainY = cy + radius * Math.sin(rad) + CHARM_PHYSICS.attachOffset;

    const wrapper = document.createElement('div');
    wrapper.className = 'charm';

    wrapper.style.left = `${chainX - CHARM_PHYSICS.anchorX}px`;
    wrapper.style.top  = `${chainY - CHARM_PHYSICS.anchorY}px`;
    wrapper.style.transform = `
      rotate(${angleDeg - 90}deg)
      scale(${CHARM_PHYSICS.scale})
    `;

    const img = document.createElement('img');
    img.src = src;
    img.style.width = CHARM_PHYSICS.size + 'px';

    wrapper.appendChild(img);
    wrapper.onclick = () => removeCharm(i);

    canvas.appendChild(wrapper);
  });
}
</script>

</body>
</html>
